<div class="calendar-container">
  <div class="calendar-header">
    <button class="nav-button" (click)="goToHome()">
      <span class="material-icons">home</span>
    </button>
    <div class="month-navigation">
      <button class="nav-button" (click)="navigateToMonth(-1)">
        <span class="material-icons">chevron_left</span>
      </button>
      <h2>{{ monthNames[month] }} {{ year }}</h2>
      <button class="nav-button" (click)="navigateToMonth(1)">
        <span class="material-icons">chevron_right</span>
      </button>
    </div>
    <button class="nav-button" (click)="goToSummary()">
      <span class="material-icons">summarize</span>
    </button>
  </div>

  <div class="calendar">
    <div class="weekdays">
      <div class="weekday" *ngFor="let day of weekdays">{{ day }}</div>
    </div>
    <div class="days">
      <!-- Spacers for the first day of month -->
      <div class="day spacer" *ngFor="let _ of getSpacersArray(); let i = index"></div>
      
      <!-- Actual days -->
      <div 
        *ngFor="let day of calendarDays" 
        class="day" 
        [ngClass]="getDayClass(day)"
        (click)="selectDay(day)"
      >
        <div class="day-number">{{ day.day }}</div>
        <div class="day-content" *ngIf="day.type !== dayTypes.NONE && !day.isWeekend && !day.isHoliday">
          <!-- Display for days with combined types -->
          <div *ngIf="day.secondaryType" class="day-mixed-type">
            <div class="day-type">{{ day.type }}</div>
            
            <!-- Caso speciale per PAR/FERIE come tipi secondari -->
            <div class="day-secondary-type" *ngIf="day.type === dayTypes.PAR || day.type === dayTypes.FERIE">
              {{ day.type }} <span>({{ day.hours || 0 }}h)</span>
              <div class="day-secondary-plus">+</div>
              {{ day.secondaryType }} <span>({{ 8 - (day.hours || 0) }}h)</span>
            </div>
            
            <!-- Caso standard per CASA/AZIENDA + PAR/FERIE -->
            <div class="day-secondary-type" *ngIf="day.type !== dayTypes.PAR && day.type !== dayTypes.FERIE">
              {{ day.type }}
              <div class="day-secondary-plus">+</div> 
              {{ day.secondaryType }} <span>({{ day.hours }}h)</span>
            </div>
          </div>
          
          <!-- Display for days with single type -->
          <div *ngIf="!day.secondaryType">
            <div class="day-type">{{ day.type }}</div>
            <div class="day-hours" *ngIf="day.hours">{{ day.hours }}h</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="monthly-summary">
    <h3>Riepilogo del mese</h3>
    <div class="summary-grid">
      <div class="summary-item">
        <div class="summary-label">Giorni CASA:</div>
        <div class="summary-value">{{ summary.casaDays }}</div>
      </div>
      <div class="summary-item">
        <div class="summary-label">Giorni AZIENDA:</div>
        <div class="summary-value">{{ summary.aziendaDays }}</div>
      </div>
      <div class="summary-item">
        <div class="summary-label">Ore PAR:</div>
        <div class="summary-value">{{ summary.parHours }}</div>
      </div>
      <div class="summary-item">
        <div class="summary-label">Ore FERIE:</div>
        <div class="summary-value">{{ summary.ferieHours }}</div>
      </div>
      <div class="summary-item">
        <div class="summary-label">Giorni MALATTIA:</div>
        <div class="summary-value">{{ summary.malattiaDays }}</div>
      </div>
      <div class="summary-item">
        <div class="summary-label">Giorni lavorativi:</div>
        <div class="summary-value">{{ summary.workingDays }}</div>
      </div>
    </div>
  </div>

  <!-- Day edit modal -->
  <div class="modal" *ngIf="selectedDay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Modifica giorno {{ selectedDay.day }} {{ monthNames[month] }} {{ year }}</h3>
        <button class="close-button" (click)="cancelEdit()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Seleziona tipo:</label>
          <div class="type-options">
            <div class="type-option" [class.selected]="selectedType === dayTypes.NONE" (click)="updateSelectedType(dayTypes.NONE)">
              <div class="color-box none"></div>
              <span>Nessuno</span>
            </div>
            <div class="type-option" [class.selected]="selectedType === dayTypes.CASA" (click)="updateSelectedType(dayTypes.CASA)">
              <div class="color-box casa"></div>
              <span>CASA</span>
            </div>
            <div class="type-option" [class.selected]="selectedType === dayTypes.AZIENDA" (click)="updateSelectedType(dayTypes.AZIENDA)">
              <div class="color-box azienda"></div>
              <span>AZIENDA</span>
            </div>
            <div class="type-option" [class.selected]="selectedType === dayTypes.PAR" (click)="updateSelectedType(dayTypes.PAR)">
              <div class="color-box par"></div>
              <span>PAR</span>
            </div>
            <div class="type-option" [class.selected]="selectedType === dayTypes.FERIE" (click)="updateSelectedType(dayTypes.FERIE)">
              <div class="color-box ferie"></div>
              <span>FERIE</span>
            </div>
            <div class="type-option" [class.selected]="selectedType === dayTypes.MALATTIA" (click)="updateSelectedType(dayTypes.MALATTIA)">
              <div class="color-box malattia"></div>
              <span>MALATTIA</span>
            </div>
          </div>
        </div>

        <div class="form-group" *ngIf="selectedType === dayTypes.PAR || selectedType === dayTypes.FERIE">
          <label>Ore: <span class="required">*</span></label>
          <select [(ngModel)]="selectedHours" (change)="updateSelectedHours()" required>
            <option [ngValue]="0" disabled>Seleziona ore</option>
            <option [ngValue]="2" *ngIf="selectedType === dayTypes.PAR">2 ore</option>
            <option [ngValue]="4">4 ore</option>
            <option [ngValue]="6" *ngIf="selectedType === dayTypes.PAR">6 ore</option>
            <option [ngValue]="8">8 ore</option>
          </select>
          <div class="info-message">
            Per i tipi PAR e FERIE Ã¨ obbligatorio inserire le ore.
          </div>
        </div>

        <!-- Secondary day type selection -->
        <div class="form-group" *ngIf="showSecondaryType">
          <label>Tipo secondario per le ore restanti:</label>
          <div class="info-message" *ngIf="selectedType === dayTypes.PAR || selectedType === dayTypes.FERIE">
            Seleziona un tipo per le rimanenti {{ 8 - selectedHours }} ore.
          </div>
          <div class="type-options">
            <div class="type-option" [class.selected]="secondaryType === dayTypes.CASA" (click)="secondaryType = dayTypes.CASA">
              <div class="color-box casa"></div>
              <span>CASA</span>
            </div>
            <div class="type-option" [class.selected]="secondaryType === dayTypes.AZIENDA" (click)="secondaryType = dayTypes.AZIENDA">
              <div class="color-box azienda"></div>
              <span>AZIENDA</span>
            </div>
            <div class="type-option" [class.selected]="secondaryType === dayTypes.PAR" 
                 [class.disabled]="isSelectedType(dayTypes.PAR)"
                 (click)="updateSecondaryType(dayTypes.PAR)" 
                 *ngIf="!isSelectedType(dayTypes.PAR)">
              <div class="color-box par"></div>
              <span>PAR ({{8 - selectedHours}} ore)</span>
            </div>
            <div class="type-option" [class.selected]="secondaryType === dayTypes.FERIE" 
                 [class.disabled]="isSelectedType(dayTypes.FERIE)"
                 (click)="updateSecondaryType(dayTypes.FERIE)" 
                 *ngIf="!isSelectedType(dayTypes.FERIE) && (!isSelectedType(dayTypes.PAR) || (isSelectedType(dayTypes.PAR) && selectedHours === 4))">
              <div class="color-box ferie"></div>
              <span>FERIE ({{8 - selectedHours}} ore)</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-button" (click)="cancelEdit()">Annulla</button>
        <button class="save-button" (click)="updateDay()">Salva</button>
      </div>
    </div>
  </div>
</div>
